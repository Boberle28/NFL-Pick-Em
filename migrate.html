<!DOCTYPE html>
<html>
<head>
  <title>Firestore Migration</title>
</head>
<body>
  <h1>Migrating Firestore Picks from Username to UID</h1>
  <pre id="output">Running migration...</pre>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      doc,
      getDocs,
      setDoc,
      getDoc,
      deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Your Firebase config here
    const firebaseConfig = {
      apiKey: "AIzaSyAHTX6gGorh3Flmvbw0THBfk9i7ILeZ2E4",
      authDomain: "football-pickem-1d2ab.firebaseapp.com",
      projectId: "football-pickem-1d2ab",
      storageBucket: "football-pickem-1d2ab.firebasestorage.app",
      messagingSenderId: "1065963734942",
      appId: "1:1065963734942:web:042b5fbe5082b9cd29788f",
      measurementId: "G-K8JV62VJ6P"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // üîÅ Map of usernames ‚Üí UIDs
    const usernameToUidMap = {

        "Amccalister88_Avamarie24!*": "eFdLWqXgA4MpXvPP9vMJ9TfmwB83",

        "Avamarie2409_Chicaisme123": "ZSPhXDny5VPDk6iYGJiTspm5o1r1",

        "Awalter_Wipaire123": "fgfqHZDPtoWAZgKFK7rJautQm983",

        "BennyMac38_Benjamin86": "2ywssjs7rwbeXJW8qaCWYAmoB0A2",

        "Brando_Winner": "XgfGB0s8tjPqas5hwetXrOTUdio2",

        "Jessetyge_Jm@n5858!!": "L47cb8h53KUgLr0lt0Smr3wXxE43",

        "Kelly_032866": "rkWaZpps1QeAbe2dqherou4JLQD2",

        "Lenchogobosho1_Horalencho$1": "oSEszYYW4KNbKAEbkKvEIbcRdvv1",

        "Michael_Pizzahut0913!": "w4B7y5bWjGNj0UQfho2ASC0VRVB3",

        "Oberlej_61578426": "GIcADWActEV5uNvZJJoV9KMFBhA2",

        "Plee22_CornDog69@": "FWVhKGTs6WTuATgLYvWTUWc0d4f1",

        "goberle_NamathJoe25": "dWenw8ENRFP46AOjmV1QWOYEUpD3"

    };

    

    const log = msg => {
      console.log(msg);
      document.getElementById("output").textContent += `\n${msg}`;
    };

    async function migratePicksToUid() {
  for (const [username, uid] of Object.entries(usernameToUidMap)) {
    const oldDocRef = doc(db, "picks", username);
    const oldDocSnap = await getDoc(oldDocRef);

    const updatedData = {
      username: username
    };

    if (oldDocSnap.exists()) {
      const data = oldDocSnap.data();

      // Add week data directly to the root
      for (const [weekKey, weekData] of Object.entries(data)) {
        updatedData[weekKey] = { ...weekData };
      }

      log(`‚úÖ Migrated picks for "${username}"`);
    } else {
      log(`üÜï Created empty record for "${username}"`);
    }

    const newDocRef = doc(db, "picks", uid);
    try{
    await setDoc(newDocRef, updatedData, { merge: true });
    }catch(err){
        log(`‚ùå Failed to migrate "${username}": ${err.message}`);
    }

  }

  log("üéâ Migration complete!");
}

    
    migratePicksToUid();
  </script>
</body>
</html>