<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NFL Pick'em - Week Demo</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      text-align: center;
    }
    .matchup {
      margin: 20px 0;
    }
    .teams {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
    }
    button {
      padding: 10px 20px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      font-size: 16px;
    }
    button.selected {
      background-color: #007bff;
      color: white;
    }
    #submitBtn {
      margin-top: 30px;
      width: 100%;
      background-color: green;
      color: white;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

  <h1>NFL Pick'em - Week Demo</h1>
  <label for="name">Your Username:</label>
  <input type="text" id="username">

  <div class="matchup" data-game="Game 1">
    <strong>Chiefs vs Bears</strong>
    <div class="teams">
      <button onclick="selectWinner(this)">Chiefs</button>
      <button onclick="selectWinner(this)">Bears</button>
    </div>
  </div>

  <div class="matchup" data-game="Game 2">
    <strong>Packers vs Lions</strong>
    <div class="teams">
      <button onclick="selectWinner(this)">Packers</button>
      <button onclick="selectWinner(this)">Lions</button>
    </div>
  </div>

  <div class="matchup" data-game="Game 3">
    <strong>Jets vs Broncos</strong>
    <div class="teams">
      <button onclick="selectWinner(this)">Jets</button>
      <button onclick="selectWinner(this)">Broncos</button>
    </div>
  </div>

  <button id="submitBtn" onclick="submitPicks()">Submit Picks</button>

  <script src ="NamesAndSchedule.js"></script>

  <script type="module">

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { 
      getFirestore,
      collection,
      query,
      where,
      gotDocs,
      addDoc
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
    
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyAHTX6gGorh3Flmvbw0THBfk9i7ILeZ2E4",
      authDomain: "football-pickem-1d2ab.firebaseapp.com",
      projectId: "football-pickem-1d2ab",
      storageBucket: "football-pickem-1d2ab.firebasestorage.app",
      messagingSenderId: "1065963734942",
      appId: "1:1065963734942:web:042b5fbe5082b9cd29788f",
      measurementId: "G-K8JV62VJ6P"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const WEEK = 1;

    function selectWinner(btn) {
      const teamBtns = btn.parentElement.querySelectorAll("button");
      teamBtns.forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
    }

    
    async function submitPicks() {
      const name = document.getElementById("name").value.trim();
      const matchups = document.querySelectorAll(".matchup");
      let picks = [];

      console.log(season);
      // Values to store games not picked
      let GamesNotPicked=[];

      matchups.forEach(matchup => {
        const gameTitle = matchup.getAttribute("data-game");
        const selected = matchup.querySelector("button.selected");
        const pick = selected ? selected.textContent : "No Pick";

        console.log(selected);

        // Check if a pick was selected
        if(pick == "No Pick"){
          GamesNotPicked.push(matchup);
          console.log("Added NoPick");
        }
      
        picks.push(`${gameTitle}: ${pick}`);
      });
        
      if(GamesNotPicked.length == 0)
      {
        // Check username
        const user = document.getElementById('username').value.trim();
        if(user.length == 0)
        {
          alert("You must enter you username, if you have not made a username yet you can enter whatever you'd like but you must use that same name every week with your picks");
          return;
        }

        // Now check if user has already picked for the week
        const picksRef = collection(db, "picks");
        const q = query(picksRef, 
          where("username", "==", user),
          where("week", "==", WEEK)
        );

        const existing = await getDocs(q);
        if(!existing.empty)
        {
          alert("You've already made your picks for the week!");
          return;
        }

        const body = encodeURIComponent(`Name: ${name}\n\nYour picks:\n${picks.join('\n')}`);
        const subject = encodeURIComponent("NFL Weekly Picks Submission");
        window.location.href = `mailto:brando2885@hotmail.com?subject=${subject}&body=${body}`;
      }
      else{
        console.log(GamesNotPicked);
        GamesNotPicked = [];
        console.log("GamesNotPicked after being emptied");
        console.log(GamesNotPicked);
        alert("You can not submit until you've picked all the games!");
      }
      
    }

    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('submitBtn').addEventListener('click', submitPicks);

      const buttons = document.querySelectorAll('.team-btn');
  
      buttons.forEach(button => {
        button.addEventListener('click', function () {
          selectWinner(this);
      });
  });
    });
     
  </script>
</body>
</html>


