<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NFL Pick'em - Week Demo</title>
  <style>
    body {
      font-family: sans-serif;
      background: #140101;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      text-align: center;
    }
    .matchup {
      margin: 20px 0;
    }
    .teams {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
    }
    button {
      padding: 10px 20px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      font-size: 16px;
    }
    button.selected {
      background-color: #17416e;
      color: white;
    }
    #submitBtn {
      margin-top: 30px;
      width: 100%;
      background-color: green;
      color: white;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h1>NFL Pick'em</h1>

  <label for="name">Your Username:</label>
  <input type="text" id="username">

  <div id="matchupsContainer"></div>
  <button id="submitBtn">Submit Picks</button>

  <script src ="NamesAndSchedule.js"></script>

  <script type="module">

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      getDocs,
      addDoc
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
    
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyAHTX6gGorh3Flmvbw0THBfk9i7ILeZ2E4",
      authDomain: "football-pickem-1d2ab.firebaseapp.com",
      projectId: "football-pickem-1d2ab",
      storageBucket: "football-pickem-1d2ab.firebasestorage.app",
      messagingSenderId: "1065963734942",
      appId: "1:1065963734942:web:042b5fbe5082b9cd29788f",
      measurementId: "G-K8JV62VJ6P"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const WEEK = 1;

    function selectWinner(btn) {
      const teamBtns = btn.parentElement.querySelectorAll("button");
      teamBtns.forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
    }

    function renderWeek(weekObj) {
    console.log("Rendering WEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEk!")
    const container = document.getElementById("matchupsContainer");
    container.innerHTML = ""; // Clear previous matchups
  
    weekObj.games.forEach((game, index) => {
      const matchupDiv = document.createElement("div");
      matchupDiv.classList.add("matchup");
      matchupDiv.dataset.game = `Game ${index + 1}`;
  
      const title = document.createElement("strong");
      title.textContent = `${game.home.name} vs ${game.away.name}`;
  
      const teamsDiv = document.createElement("div");
      teamsDiv.classList.add("teams");
  
      const homeBtn = document.createElement("button");
      homeBtn.textContent = game.home.name;
      homeBtn.classList.add("team-btn");
      homeBtn.addEventListener("click", function () {
        selectWinner(this);
      });

      const awayBtn = document.createElement("button");
      awayBtn.textContent = game.away.name;
      awayBtn.classList.add("team-btn");
      awayBtn.addEventListener("click", function () {
        selectWinner(this);
      });
  
      teamsDiv.appendChild(homeBtn);
      teamsDiv.appendChild(awayBtn);
      matchupDiv.appendChild(title);
      matchupDiv.appendChild(teamsDiv);
      container.appendChild(matchupDiv);
    });
  }
    renderWeek(week1);
    
    async function submitPicks() {
      const matchups = document.querySelectorAll(".matchup");
      let picks = [];

      // Values to store games not picked
      let GamesNotPicked=[];

      matchups.forEach(matchup => {
        const gameTitle = matchup.getAttribute("data-game");
        const selected = matchup.querySelector("button.selected");
        const pick = selected ? selected.textContent : "No Pick";

        console.log(selected);

        // Check if a pick was selected
        if(pick == "No Pick"){
          GamesNotPicked.push(matchup);
          console.log("Added NoPick");
        }
      
        picks.push(`${gameTitle}: ${pick}`);
      });
        
      if(GamesNotPicked.length == 0)
      {
        // Check username
        const user = document.getElementById('username').value.trim();
        if(user.length == 0)
        {
          alert("You must enter you username, if you have not made a username yet you can enter whatever you'd like but you must use that same name every week with your picks");
          return;
        }

        // Now check if user has already picked for the week
        const picksRef = collection(db, "picks");
        const q = query(picksRef, 
          where("username", "==", user),
          where("week", "==", WEEK)
        );

        const existing = await getDocs(q);
        if(!existing.empty)
        {
          alert("You've already made your picks for the week!");
          return;
        }

        const body = encodeURIComponent(`Name: ${user}\n\nYour picks:\n${picks.join('\n')}`);
        const subject = encodeURIComponent("NFL Weekly Picks Submission");
        window.location.href = `mailto:brando2885@hotmail.com?subject=${subject}&body=${body}`;
      }
      else{
        console.log(GamesNotPicked);
        GamesNotPicked = [];
        console.log("GamesNotPicked after being emptied");
        console.log(GamesNotPicked);
        alert("You can not submit until you've picked all the games!");
      }
      
    }

    window.addEventListener('DOMContentLoaded', () => {
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.addEventListener('click', submitPicks);

      const buttons = document.querySelectorAll('.teams button');
      buttons.forEach(button => {
         button.addEventListener('click', () => selectWinner(button));
      });
    });
     
  </script>
</body>
</html>


